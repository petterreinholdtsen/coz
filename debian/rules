#!/usr/bin/make -f

# Make tarball for Debian.  Remove irrelevant parts with various
# copyright status and licenses to reduce the amount of files we need
# to track the copyright status of.
DEBIAN_DIR = $(dir $(firstword $(MAKEFILE_LIST)))
ver=0.0.git
gitref=master
get-orig-source:
	cd $(DEBIAN_DIR)../ && \
	git clone -b $(gitref) https://github.com/plasma-umass/coz coz-profiler-$(ver) && \
	git clone -b gh-pages https://github.com/plasma-umass/coz coz-profiler-$(ver)/viewer && \
	make -C coz-profiler-$(ver) deps/ccutil && \
	make -C coz-profiler-$(ver) deps/libelfin/Makefile && \
	rm -rf coz-profiler-$(ver)/.git coz-profiler-$(ver)/viewer/.git coz-profiler-$(ver)/deps/*/.git && \
	rm -rf coz-profiler-$(ver)/benchmarks/ && \
	tar zcf coz-profiler-$(ver).tar.gz coz-profiler-$(ver) && \
	rm -rf coz-profiler-$(ver)

export DH_VERBOSE=1

%:
	dh $@

# Generate manual page from RST document
debian/coz.1: debian/coz.rst
	rst2man $< > $@
override_dh_installman: debian/coz.1
	dh_installman

override_dh_auto_test:
	$(MAKE) check
